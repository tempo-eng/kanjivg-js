<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KanjiVG JavaScript Library - Demo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .search-container {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .search-input {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        
        .search-button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .search-button:hover {
            background: #0056b3;
        }
        
        .kanji-display {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .kanji-svg {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            min-width: 200px;
        }
        
        .kanji-info {
            flex: 1;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        .controls button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .progress {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            background: #f0f0f0;
            border-radius: 4px;
            height: 20px;
        }
        
        .progress-fill {
            background: #007bff;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 5px;
        }
        
        .stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .loading {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>KanjiVG JavaScript Library - Demo</h1>
    
    <div class="stats">
        <p><strong>Dataset:</strong> <span id="datasetInfo">Loading...</span></p>
        <p><strong>Total Kanji:</strong> <span id="totalCount">-</span></p>
        <p><strong>Search Results:</strong> <span id="searchResults">-</span></p>
    </div>
    
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Enter kanji character..." />
        <button id="searchButton" class="search-button">Search</button>
        <button id="randomButton" class="search-button">Random Kanji</button>
    </div>
    
    <div id="errorMessage" class="error" style="display: none;"></div>
    
    <div id="kanjiDisplay" class="kanji-display" style="display: none;">
        <div class="kanji-svg" id="kanjiSVG"></div>
        <div class="kanji-info" id="kanjiInfo"></div>
    </div>
    
    <div class="controls" id="controls" style="display: none;">
        <button id="startBtn">▶️ Start Animation</button>
        <button id="pauseBtn" disabled>⏸️ Pause</button>
        <button id="resumeBtn" disabled>▶️ Resume</button>
        <button id="stopBtn" disabled>⏹️ Stop</button>
    </div>
    
    <div class="progress" id="progress" style="display: none;">
        <div class="progress-bar">
            <div id="progressBar" class="progress-fill" style="width: 0%;"></div>
        </div>
        <div id="progressText" class="progress-text">0 / 0</div>
    </div>

    <script type="module">
        // Mock KanjiVG class for demonstration
        class MockKanjiVG {
            constructor(data) {
                this.data = data;
            }
            
            lookup(input) {
                let code;
                if (typeof input === 'string') {
                    if (input.length === 1) {
                        code = input.charCodeAt(0).toString(16).padStart(5, '0');
                    } else {
                        code = input;
                    }
                } else {
                    code = input.toString(16).padStart(5, '0');
                }
                
                const kanji = this.data.kanji[code];
                if (!kanji) return null;
                
                return {
                    character: kanji.character,
                    code: kanji.code,
                    strokeCount: this.getStrokeCount(kanji),
                    strokeTypes: this.getStrokeTypes(kanji),
                    components: [],
                    radicals: [],
                    svg: this.generateSVG(kanji)
                };
            }
            
            search(character) {
                const results = [];
                const svgFiles = this.data.index[character] || [];
                
                for (const svgFile of svgFiles) {
                    const code = svgFile.replace('.svg', '');
                    const kanji = this.data.kanji[code];
                    if (kanji) {
                        results.push(this.lookup(code));
                    }
                }
                
                return results;
            }
            
            getStrokeCount(kanji) {
                return this.getAllStrokes(kanji.strokes).length;
            }
            
            getStrokeTypes(kanji) {
                return this.getAllStrokes(kanji.strokes).map(s => s.type || '');
            }
            
            getAllStrokes(group) {
                let strokes = [...(group.strokes || [])];
                for (const childGroup of group.groups || []) {
                    strokes = strokes.concat(this.getAllStrokes(childGroup));
                }
                return strokes;
            }
            
            generateSVG(kanji) {
                const allStrokes = this.getAllStrokes(kanji.strokes);
                
                let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="109" height="109" viewBox="0 0 109 109" style="fill:none;stroke:#000000;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;">`;
                svg += `<g id="kvg:StrokePaths_${kanji.code}">`;
                
                for (let i = 0; i < allStrokes.length; i++) {
                    const stroke = allStrokes[i];
                    svg += `<path id="kvg:${kanji.code}-s${i + 1}" kvg:type="${stroke.type || ''}" d="${stroke.path || 'M0,0'}" style="stroke-dasharray: 1000; stroke-dashoffset: 1000; fill:none;stroke:#000000;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;">`;
                    svg += `</path>`;
                }
                
                svg += `</g></svg>`;
                return svg;
            }
            
            getRandomKanji() {
                const codes = Object.keys(this.data.kanji);
                const randomCode = codes[Math.floor(Math.random() * codes.length)];
                return this.lookup(randomCode);
            }
        }
        
        // Initialize
        let kanjivg = null;
        let currentKanji = null;
        let animationState = {
            isPlaying: false,
            isPaused: false,
            currentStroke: 0,
            totalStrokes: 0
        };
        
        // Load data
        async function loadData() {
            try {
                document.getElementById('datasetInfo').textContent = 'Loading full dataset...';
                
                const dataResponse = await fetch('../data/kanjivg-data.json');
                const data = await dataResponse.json();
                
                kanjivg = new MockKanjiVG(data);
                
                document.getElementById('datasetInfo').textContent = 'Full dataset loaded';
                document.getElementById('totalCount').textContent = Object.keys(data.kanji).length;
                
                // Load a random kanji to start
                displayKanji(kanjivg.getRandomKanji());
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('errorMessage').textContent = 'Error loading dataset: ' + error.message;
                document.getElementById('errorMessage').style.display = 'block';
            }
        }
        
        // Display kanji
        function displayKanji(kanji) {
            if (!kanji) {
                document.getElementById('errorMessage').textContent = 'Kanji not found';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }
            
            document.getElementById('errorMessage').style.display = 'none';
            currentKanji = kanji;
            animationState.totalStrokes = kanji.strokeCount;
            animationState.currentStroke = 0;
            
            document.getElementById('kanjiSVG').innerHTML = kanji.svg;
            document.getElementById('kanjiInfo').innerHTML = `
                <h2>${kanji.character}</h2>
                <p><strong>Unicode:</strong> U+${kanji.code.toUpperCase()}</p>
                <p><strong>Strokes:</strong> ${kanji.strokeCount}</p>
                <p><strong>Stroke Types:</strong> ${kanji.strokeTypes.join(', ')}</p>
            `;
            
            document.getElementById('kanjiDisplay').style.display = 'flex';
            document.getElementById('controls').style.display = 'block';
            document.getElementById('progress').style.display = 'block';
            
            updateControls();
        }
        
        // Animation controls
        function startAnimation() {
            if (!currentKanji) return;
            
            // Reset all strokes to invisible
            for (let i = 1; i <= currentKanji.strokeCount; i++) {
                const strokeId = `kvg:${currentKanji.code}-s${i}`;
                const strokeElement = document.getElementById(strokeId);
                if (strokeElement) {
                    strokeElement.style.strokeDashoffset = '1000';
                    strokeElement.style.transition = 'none';
                }
            }
            
            // Reset progress
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0 / ' + currentKanji.strokeCount;
            
            animationState.isPlaying = true;
            animationState.isPaused = false;
            animationState.currentStroke = 0;
            
            updateControls();
            animateStrokes();
        }
        
        function pauseAnimation() {
            animationState.isPlaying = false;
            animationState.isPaused = true;
            updateControls();
        }
        
        function resumeAnimation() {
            animationState.isPlaying = true;
            animationState.isPaused = false;
            updateControls();
        }
        
        function stopAnimation() {
            animationState.isPlaying = false;
            animationState.isPaused = false;
            animationState.currentStroke = 0;
            updateControls();
        }
        
        function animateStrokes() {
            if (!animationState.isPlaying || animationState.isPaused) return;
            
            if (animationState.currentStroke < animationState.totalStrokes) {
                const strokeId = `kvg:${currentKanji.code}-s${animationState.currentStroke + 1}`;
                const strokeElement = document.getElementById(strokeId);
                if (strokeElement) {
                    strokeElement.style.strokeDashoffset = '1000';
                    strokeElement.style.transition = 'stroke-dashoffset 0.8s ease-in-out';
                    strokeElement.style.strokeDashoffset = '0';
                }
                
                const progress = (animationState.currentStroke + 1) / animationState.totalStrokes;
                document.getElementById('progressBar').style.width = `${progress * 100}%`;
                document.getElementById('progressText').textContent = `${animationState.currentStroke + 1} / ${animationState.totalStrokes}`;
                
                animationState.currentStroke++;
                
                if (animationState.currentStroke < animationState.totalStrokes) {
                    setTimeout(animateStrokes, 1000);
                } else {
                    animationState.isPlaying = false;
                    updateControls();
                }
            }
        }
        
        function updateControls() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resumeBtn = document.getElementById('resumeBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (!animationState.isPlaying && !animationState.isPaused) {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                resumeBtn.disabled = true;
                stopBtn.disabled = true;
            } else if (animationState.isPlaying) {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                resumeBtn.disabled = true;
                stopBtn.disabled = false;
            } else if (animationState.isPaused) {
                startBtn.disabled = true;
                pauseBtn.disabled = true;
                resumeBtn.disabled = false;
                stopBtn.disabled = false;
            }
        }
        
        // Event listeners
        document.getElementById('searchButton').addEventListener('click', function() {
            const input = document.getElementById('searchInput').value.trim();
            if (!input || !kanjivg) return;
            
            const kanji = kanjivg.lookup(input);
            if (kanji) {
                displayKanji(kanji);
                document.getElementById('searchResults').textContent = '1 result';
            } else {
                // Try search for multiple results
                const results = kanjivg.search(input);
                if (results.length > 0) {
                    displayKanji(results[0]);
                    document.getElementById('searchResults').textContent = `${results.length} results`;
                } else {
                    document.getElementById('errorMessage').textContent = 'No kanji found';
                    document.getElementById('errorMessage').style.display = 'block';
                }
            }
        });
        
        document.getElementById('randomButton').addEventListener('click', function() {
            if (!kanjivg) return;
            const randomKanji = kanjivg.getRandomKanji();
            displayKanji(randomKanji);
            document.getElementById('searchResults').textContent = 'Random kanji';
        });
        
        document.getElementById('startBtn').addEventListener('click', startAnimation);
        document.getElementById('pauseBtn').addEventListener('click', pauseAnimation);
        document.getElementById('resumeBtn').addEventListener('click', resumeAnimation);
        document.getElementById('stopBtn').addEventListener('click', stopAnimation);
        
        // Load data on page load
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
