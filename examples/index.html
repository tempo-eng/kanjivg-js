<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KanjiVG JavaScript Library - Interactive Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .stats {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stats p {
            margin: 5px 0;
            font-size: 16px;
        }
        
        .loading-container {
            text-align: center;
            padding: 40px;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #666;
            font-size: 16px;
        }
        
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .search-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .search-button:hover {
            background-color: #2980b9;
        }
        
        .kanji-display {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(201, 201, 201, 0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        .kanji-svg {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .kanji-info {
            text-align: center;
        }
        
        .kanji-info h3 {
            font-size: 48px;
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }
        
        .controls button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
        }
        
        .controls button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .progress {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #3498db;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
            color: #333;
        }
        
        .error {
            color: #e74c3c;
            background-color: #fdf2f2;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>KanjiVG JavaScript Library - Interactive Demo</h1>
    
    <div class="stats">
        <p><strong>Dataset:</strong> <span id="datasetInfo">Loading...</span></p>
        <p><strong>Total Kanji:</strong> <span id="totalCount">-</span></p>
        <p><strong>Search Results:</strong> <span id="searchResults">-</span></p>
    </div>
    
    <div class="loading-container" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading KanjiVG data...</p>
    </div>
    
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Enter kanji character..." />
        <button id="searchButton" class="search-button">Search</button>
        <button id="randomButton" class="search-button">Random Kanji</button>
    </div>
    
    <div id="errorMessage" class="error" style="display: none;"></div>
    
    <div id="kanjiDisplay" class="kanji-display" style="display: none;">
        <div class="kanji-svg" id="kanjiSVG"></div>
        <div class="kanji-info" id="kanjiInfo"></div>
    </div>
    
    <div class="controls" id="controls" style="display: none;">
        <button id="startBtn">‚ñ∂Ô∏è Start Animation</button>
        <button id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
        <button id="resumeBtn" disabled>‚ñ∂Ô∏è Resume</button>
        <button id="stopBtn" disabled>‚èπÔ∏è Stop</button>
        <button id="showAllBtn">üëÅÔ∏è Show All</button>
    </div>
    
    <div class="progress" id="progress" style="display: none;">
        <div class="progress-bar">
            <div id="progressBar" class="progress-fill" style="width: 0%;"></div>
        </div>
        <div id="progressText" class="progress-text">0 / 0</div>
    </div>

    <script type="module">
        // Import the real KanjiVG library (core bundle without React)
        const { getKanjiVG } = await import('../dist/core.esm.js');
        
        // Initialize
        let kanjivg = null;
        let currentKanji = null;
        let animationState = {
            isPlaying: false,
            isPaused: false,
            currentStroke: 0,
            totalStrokes: 0
        };
        
        // Auto-load the data
        async function initializeDemo() {
            try {
                kanjivg = await getKanjiVG();
                
                // Update UI
                document.getElementById('datasetInfo').textContent = 'Auto-loaded dataset';
                document.getElementById('totalCount').textContent = kanjivg.getTotalCount().toLocaleString();
                document.getElementById('loadingContainer').style.display = 'none';
                
            } catch (error) {
                console.error('Failed to load KanjiVG data:', error);
                document.getElementById('datasetInfo').textContent = 'Failed to load data';
                document.getElementById('loadingContainer').innerHTML = 
                    '<p class="error">Failed to load KanjiVG data. Please check the console for details.</p>';
            }
        }
        
        // Display kanji
        function displayKanji(kanji) {
            if (!kanji) return;
            
            currentKanji = kanji;
            document.getElementById('kanjiDisplay').style.display = 'block';
            document.getElementById('controls').style.display = 'block';
            document.getElementById('progress').style.display = 'block';
            
            // Update kanji info
            const infoDiv = document.getElementById('kanjiInfo');
            infoDiv.innerHTML = `
                <h3>${kanji.character}</h3>
                <p><strong>Unicode:</strong> U+${kanji.code.toUpperCase()}</p>
                <p><strong>Strokes:</strong> ${kanji.strokeCount}</p>
                <p><strong>Variant:</strong> ${kanji.variant || 'base'}</p>
            `;
            
            // Update SVG
            document.getElementById('kanjiSVG').innerHTML = kanji.svg;
            
            // Hide all strokes initially (for animation)
            const paths = document.querySelectorAll('#kanjiSVG path');
            paths.forEach(path => {
                path.style.strokeDasharray = '1000';
                path.style.strokeDashoffset = '1000';
            });
            
            // Reset animation state
            animationState = {
                isPlaying: false,
                isPaused: false,
                currentStroke: 0,
                totalStrokes: kanji.strokeCount
            };
            
            updateProgress();
            updateControls();
        }
        
        // Animation functions
        function updateProgress() {
            const progress = animationState.totalStrokes > 0 ? 
                (animationState.currentStroke / animationState.totalStrokes) * 100 : 0;
            
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = 
                `${animationState.currentStroke} / ${animationState.totalStrokes}`;
        }
        
        function updateControls() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resumeBtn = document.getElementById('resumeBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            startBtn.disabled = animationState.isPlaying;
            pauseBtn.disabled = !animationState.isPlaying || animationState.isPaused;
            resumeBtn.disabled = !animationState.isPaused;
            stopBtn.disabled = !animationState.isPlaying && !animationState.isPaused;
        }
        
        function startAnimation() {
            if (!currentKanji) return;
            
            animationState.isPlaying = true;
            animationState.isPaused = false;
            animationState.currentStroke = 0;
            
            updateControls();
            animateStrokes();
        }
        
        function pauseAnimation() {
            animationState.isPaused = true;
            updateControls();
        }
        
        function resumeAnimation() {
            animationState.isPaused = false;
            updateControls();
            animateStrokes();
        }
        
        function stopAnimation() {
            animationState.isPlaying = false;
            animationState.isPaused = false;
            animationState.currentStroke = 0;
            
            // Hide all strokes
            const paths = document.querySelectorAll('#kanjiSVG path');
            paths.forEach(path => {
                path.style.strokeDasharray = '1000';
                path.style.strokeDashoffset = '1000';
            });
            
            updateProgress();
            updateControls();
        }
        
        function showAllStrokes() {
            // Show all strokes (remove dash animation)
            const paths = document.querySelectorAll('#kanjiSVG path');
            paths.forEach(path => {
                path.style.strokeDasharray = 'none';
                path.style.strokeDashoffset = '0';
            });
        }
        
        function animateStrokes() {
            if (!animationState.isPlaying || animationState.isPaused) return;
            
            const paths = document.querySelectorAll('#kanjiSVG path');
            const currentPath = paths[animationState.currentStroke];
            
            if (currentPath) {
                // Animate current stroke
                currentPath.style.strokeDasharray = 'none';
                currentPath.style.strokeDashoffset = '0';
                
                setTimeout(() => {
                    animationState.currentStroke++;
                    updateProgress();
                    
                    if (animationState.currentStroke >= animationState.totalStrokes) {
                        animationState.isPlaying = false;
                        showAllStrokes(); // Show all strokes when animation completes
                        updateControls();
                    } else {
                        animateStrokes();
                    }
                }, 800);
            }
        }
        
        // Search function
        function searchKanji() {
            if (!kanjivg) return;
            
            const input = document.getElementById('searchInput').value.trim();
            if (!input) return;
            
            try {
                const results = kanjivg.search(input);
                document.getElementById('searchResults').textContent = results.length;
                
                if (results.length > 0) {
                    displayKanji(results[0]); // Show first result
                    
                    if (results.length > 1) {
                        console.log(`Found ${results.length} variants:`, results.map(r => r.variant || 'base'));
                    }
                } else {
                    document.getElementById('kanjiDisplay').style.display = 'none';
                    alert('No kanji found for: ' + input);
                }
            } catch (error) {
                console.error('Search error:', error);
                alert('Search error: ' + error.message);
            }
        }
        
        function getRandomKanji() {
            if (!kanjivg) return;
            
            try {
                const allCharacters = kanjivg.getAllCharacters();
                const randomCharacter = allCharacters[Math.floor(Math.random() * allCharacters.length)];
                const results = kanjivg.search(randomCharacter);
                
                if (results.length > 0) {
                    displayKanji(results[0]);
                    document.getElementById('searchInput').value = randomCharacter;
                    document.getElementById('searchResults').textContent = results.length;
                }
            } catch (error) {
                console.error('Random kanji error:', error);
            }
        }
        
        // Event listeners
        document.getElementById('searchButton').addEventListener('click', searchKanji);
        document.getElementById('randomButton').addEventListener('click', getRandomKanji);
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchKanji();
        });
        
        document.getElementById('startBtn').addEventListener('click', startAnimation);
        document.getElementById('pauseBtn').addEventListener('click', pauseAnimation);
        document.getElementById('resumeBtn').addEventListener('click', resumeAnimation);
        document.getElementById('stopBtn').addEventListener('click', stopAnimation);
        document.getElementById('showAllBtn').addEventListener('click', showAllStrokes);
        
        // Initialize the demo
        initializeDemo();
    </script>
</body>
</html>
